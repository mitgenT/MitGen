def enhanced_solve(N, M):
    <MASK>